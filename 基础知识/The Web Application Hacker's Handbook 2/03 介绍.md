# 介绍

本书是一本关于发现和利用网络应用程序安全漏洞的实用指南。我们所说的”网络应用程序“是指使用网络浏览器与网络服务器通信的应用程序。我们检查了各种不同的技术，例如数据库、文件系统和Web服务，但仅限于这些技术在网络应用程序中的应用。

如果你像学习如何运行端口扫描、攻击防火墙或以其他方式入侵服务器，我们建议您寻找其他资料。但是，如果你想知道如何入侵网络应用程序、窃取敏感数据并执行未经授权的操作，那么本书适合您。关于这个主题，有足够有趣和好玩的内容，无需涉足其他领域。

## 概述

本书的重点是非常实用的。尽管我们提供了足够的背景知识和理论，以便你理解网络应用程序中存在的漏洞，但我们的主要关注点是你需要掌握的入侵应用程序的任务和技术。本书详细说明了检测每种漏洞所需的具体的步骤，以及如何利用漏洞执行未经授权的操作。我们还包含了大量来自作者多年经验的真实案例，说明不同类型的安全漏洞在当今的网络应用程序中是如何表现的。

安全意识通常是一把双刃剑。正如应用程序开发人员可以受益于了解攻击者使用的方法一样，黑客也可以从了解应用储层徐如何有效自我防御中获益。除了描述安全漏洞和攻击技术之外，我们还详细描述了应用程序可以采取的抵御攻击者的对策。如果你执行网络应用此程序渗透测试，这让你能够为你入侵的应用程序的所有者提供高质量的修复建议。

## 谁应该阅读本书

本书的主要读者群是任何对攻击网络应用程序有个人或专业兴趣的人。它也面向任何负责开发和管理网络应用程序的人。了解敌人的运作方式将有助于防范他们。

我们假设你熟悉核心安全概念，例如登录和访问控制、并且对核心Web技术（如浏览器、Web服务器和HTTP）有一定的了解。但是，如果你目前对这些领域的知识有任何空白，可以通过本书中的解释或其他参考资料轻松弥补。

在说明许多类别安全漏洞的过程中，我们提供了代码片段，展示了应用程序如何变得脆弱。这些示例足够简单，即使你没有任何相关语言的预备知识也能理解。但是，如果你具备一定的代码阅读或编写经验，这些示例将更有用。

## 本书结构

本书的组织结构大致遵循不同主题之间的依赖关系。如果你是网络应用程序黑客的新手，应该从头到尾阅读本书，获取掌握后续章节所需的知识和理解。如果你已经具备一些相关经验，你可以直接跳到任何你特别感兴趣的章节或小节。必要时，我们提供了对其它章节的交叉引用，你可以使用它们来填补你理解中的任何空白。

我们从三个设置上下文的章节开始，描述网络应用程序安全现状以及未来可能发展的趋势。我们研究了影响网络应用程序的核心安全问题以及应用程序为解决此问题而实施的防御机制。我们还提供了有关当今网络应用程序中使用的关键技术的入门知识。

本书的大部分内容设计我们的核心主题——你可以用来入侵网络应用程序的技术。这些材料围绕你需要执行以进行全面攻击的关键任务进行组织。这些包括映射应用程序的功能、仔细检查和攻击其核心防御机制，以及探测特定类别的安全漏洞。

本书最后包含三章，将书中介绍的各个主体整合在一起，我们描述了在应用程序源代码中查找漏洞的过程，回顾了在黑客攻击网络应用程序时可以使用的工具，并介绍了一种针对特定目标执行全面深入攻击的详细方法。

**第1章”网络应用程序（不）安全性“** 描述了当今互联网上网络应用程序的安全现状。尽管有普遍的保证，但大多数应用程序仍然是不安全的，可以通过一定程度的技能以某种方式破坏。网络应用程序中的漏洞源于一个核心问题：用户可以提交任意输入。本章研究了导致当今应用程序安全态势薄弱的关键因素。它还描述了网络应用程序中的缺陷如何使组织的更多的技术和基础设施更易受到攻击。

**第2章”核心防御机制“** 描述了网络应用程序用来解决所有用户输入不可信的基本问题的关键安全机制。这些机制是应用程序管理用户访问、处理用户输入和响应攻击者的方式。这些机制还包括为管理员管理和监控应用程序提供的功能。应用程序的核心安全机制也代表其主要攻击面，因此你需要了解这些机制的预期功能才能有效地攻击它们。

**第3章”网络应用程序技术“** 是关于你在攻击网络应用程序时可能遇到的关键技术的简要介绍。它涵盖了HTTP协议的所有相关方面、客户端和服务器端常用的技术以及用于编码数据的各种方案。如果你已经熟悉主要的Web技术，可以快速浏览本章。

**第4章”映射应用程序“** 描述了你在针对新应用程序时需要执行的第一项联系——收集尽可能多的信息以映射其攻击面并指定攻击计划。此过程包括探索和探测应用程序以编目其所有内容和功能，识别所有用户输入的入口点，并发现正在使用的技术。

**第5章”绕过客户端控制“** 涵盖了第一个实际漏洞领域，该漏洞出现在应用程序依赖于客户端上实现的控制来保证其安全时。这种方法通常是有缺陷的，因为任何客户端控制都可以绕过。应用程序让自己变得脆弱的两种主要方式是通过客户端传输数据并假设它不会被修改，以及依赖于客户端对用户输入的检查。本章描述了一系列有趣的技术，包括在HTML、HTTP和JavaScript中实现的轻量级控件，以及使用java小程序、ActiveX空间、Silverlight和Flash对象的更重量级控件。

第6、7和8章涵盖了网络应用程序中实现的一些重要的防御机制：负责控制用户访问的机制。**第6章”攻击身份认证“** 检查应用程序通过各种功能保证用户身份的方式。这包括主要的登录功能以及更多外围的身份认证相关功能，例如用户注册、密码更改和账户恢复。身份认证机制在设计和实现方面包含大量不同的漏洞，攻击者可以利用这些漏洞获得未经授权的访问。这些漏洞范围从明显的缺陷，如弱口令和易受暴力破解，到认证逻辑中更隐蔽的问题。我们还详细研究了许多安全关键型应用程序中使用的多阶段登录机制类型，并描述了这些机制经常包含的新型漏洞。

**第7章”攻击会话管理“** 检查大多数应用程序如何使用有状态会话的概念来补充无状态HTTP协议，从而能够在多个不同请求中唯一标识每个用户。当你攻击网络应用程序时，该机制是一个关键目标，因为如果你能够破坏它，你就可以有效地绕过登录并冒充其他用户而无需知道它们的凭据。我们查看了会话令牌生成和传输中的各种常见缺陷，并描述了你可以采取的发现和利用这些缺陷的步骤。

**第8章”攻击访问控制“** 研究了应用程序实际执行访问控制的方式，依赖于身份认证和会话管理机制来实现。我们描述了访问控制可以被破坏的各种方式以及如何检测和利用这些弱点。

第9和10章涵盖了一大类相关的漏洞，这些漏洞是在应用程序以不安全的方式将用户输入嵌入到解释型代码中时出现的。**第9章”攻击数据存储“** 从详细检查SQL注入漏洞开始。它涵盖了从最明显和最琐碎的攻击到涉及带外通道、推理和时间延迟的先进利用技术的全方位攻击。对于每种漏洞和攻击技术，我们描述了三种常见数据库（MS-SQL、Oracle和MySQL）之间的相关差异。然后，我们研究了一系列针对其他数据存储的类似攻击，包括NoSQL、Xpath和LDAP。

**第10章”攻击后端组件“** ，描述了几种其他类型的注入漏洞，包括操作系统命令注入、Web脚本语言注入、文件路径遍历攻击、文件包含漏洞、XML、SOAP、后端HTTP请求和电子邮件服务注入。

**第11章”攻击应用程序逻辑“** 研究了每个应用程序攻击面中一个重要且经常被忽视的领域：其用于实现其功能的内部逻辑。应用程序逻辑中的缺陷变化很大，并且比SQL注入和跨站点脚本等常见漏洞更难表征。出于这个原因，我们提供了一系列现实世界的示例，其中有缺陷的逻辑使应用程序容易受到攻击。这些说明了应用程序设计人员和开发人员所做的各种错误假设。从这些不同的单个缺陷中，我们得出了一系列特定的测试，你可以执行这些测试来定位许多经常被忽略的逻辑缺陷。

第12和13章涵盖了一个庞大且非常热门的相关漏洞领域，这些漏洞在网络应用程序中的缺陷可以使恶意用户攻击其他用户并以各种方式侵害他们。**第12章”攻击用户：跨站点脚本“** 检查了这种类型最突出的漏洞——影响互联网上绝大多数网络应用程序的普遍缺陷。我们详细检查了XSS漏洞的所有不同变体，并描述了一种有效的方法来检测和利用这些漏洞的最隐蔽表现形式。

**第13章”攻击用户：其他技术“** 研究了针对其他用户的集中其他类型的攻击，包括通过请求伪造和UI修复诱导用户操作，使用各种客户端技术跨域捕获数据，针对同源策略的各种攻击，HTTP头注入、cookie注入和会话固定、开放重定向、客户端SQL注入、本地隐私攻击以及利用ActiveX控件中的漏洞。本章以讨论一系列针对用户的攻击结束，这些攻击不依赖于任何特定网络应用程序中的漏洞，但可以通过任何恶意网站或适当定位的攻击者进行传递。

**第14章”自动化定制攻击“** 没有介绍任何新的漏洞类别。相反，它描述了你需要掌握的有效攻击网络应用程序的关键技术。由于每个网络应用程序都不同，大多数攻击都是以某种方式定制的，以适应应用程序的特定行为以及你发现可以利用其优势的方式。它们通常还需要发出大量类似的请求并监控应用程序的响应。手动执行这些请求及其繁琐且容易出错。要成为一名真正成功的网络应用程序黑客，你需要尽可能自动化大部分工作，以使你的定制攻击更容易、更快、更有效。本章详细描述了实现这一目标的可靠方法。我们还研究了使用自动化的各种常见障碍，包括防御性会话处理机制和CAPTCHA控制。此外，我们描述了你可以用来克服这些障碍的工具和技术。

**第15章”利用信息泄露“** 检查了应用程序在受到主动攻击时泄露信息的各种方式。当你执行本书中描述的所有其他类型的攻击时，你应该始终监控应用程序以识别可以利用的更多信息泄露源。我们描述了如何调查异常行为和错误消息以更深入地了解应用程序的内部工作并微调你的攻击。我们还介绍了如何操纵有缺陷的错误处理以系统地从应用程序中检索敏感信息。

**第16章”攻击原生编译应用程序“** 研究了一组重要的漏洞，这些漏洞出现在用C和C++等原生代码语言编写的应用程序中。这些漏洞包括缓冲区溢出、整数漏洞和格式字符串缺陷。由于这是一个潜在的巨大话题，我们专注于检测网络应用程序中这些漏洞的方法，并查看一些现实世界的示例，说明这些漏洞是如何出现和被利用的。

**第17章”攻击应用程序架构“** 研究了网络应用程序安全的一个重要领域，该领域经常被忽视。许多应用程序采用分层架构。未能正确隔离不同层级通常会使应用程序容易受到攻击，使发现了一个组件缺陷的攻击者能够快速地破坏整个应用程序。共享托管环境中会出现一系列不同的威胁，其中一个应用此程序中的缺陷或恶意代码有时可以被利用来破坏环境本身和其中运行的其他应用程序。本章还要救了在被称为”云计算“的共享托管环境中出现的一系列威胁。

**第18章”攻击应用程序服务器“** ，描述了你可以通过针对他的Web服务器来攻击Web应用程序的各种方式。Web服务器中的漏洞主要由其配置中的缺陷和Web服务器软件中的安全漏洞组成。该主题术语本书涵盖主体的边界，因为Web服务器严格来说是技术栈中的不同组件。但是，大多数网络应用程序与它们运行的Web服务器紧密绑定。因此，本书中包含了针对Web服务器的攻击，因为它们通常可以用于直接破坏应用程序，而不是通过首先破坏底层来简介破坏应用程序。

 **第19章”在源代码中查找漏洞“** 描述了一种你与本书其他地方描述的完全不同的查找安全漏洞的方法。在许多情况下，可以查看应用程序的源代码，而不需要应用程序所有者的合作。审查应用程序的源代码通常可以非常有效地发现通过探测正在运行的应用程序难以或耗时检测到的漏洞。我们描述了一种方法，并提供了一份语言特定的备忘单，使你即使只有有限的编程经验也能有效地进行代码审查。

**第20章”网络应用程序黑客工具箱“** 汇集了本书中描述的各种工具。这些是作者在攻击现实世界网络应用程序时使用的相同工具。我们检查了这些工具的关键特性，并详细描述了通常需要使用的工作流程以充分利用它们。我们还研究了完全自动化工具在发现网络应用程序漏洞方面的有效程度。最后，我们提供了一些提示和建议，以帮助你充分利用你的工具箱。

**第21章”网络应用程序黑客方法论“** 是对本书中描述的所有程序和技术的全面和结构化整理。这些根据你执行实际攻击时任务之间的逻辑依赖关系进行组织和排序。如果你已经阅读并理解了本书中描述的所有漏洞和技术，你可以使用此方法论作为完整的检查表和工作计划，以对网络应用程序进行攻击。

## 本版新增内容

自本书第一版出版以来，四年过去了，很多事情发生了变化，很多事情也保持不变。当然，新技术的进步一直在加速，这催生了特定的新漏洞和攻击。黑客的聪明才智也导致了新攻击技术和利用旧漏洞的新方法的开发。但这两个因素，无论是技术还是人类，都没有创造革命。当今应用程序中使用的技术源于许多年前的技术。而当今尖端开发技术中涉及的基本概念比许多应用这些概念的研究人员还要老。网络应用程序安全是一个充满活力和令人兴奋的工作领域，但我们积累的大部分智慧的绝大部分是在多年内缓慢发展起来的。十年前或更早工作的从业者可以明显的感知。

  第二版不是第一版的完全重写。第一版中的大部分材料在今天仍然有效且最新。本版本中约30%的内容是新的或经过广泛修订。其余70%只有轻微修改或根本没有修改。如果你从第一版升级并对这些数字失望，你应该振作起来。如果你已经掌握了第一版中描述的所有技术，那么你已经拥有了大部分所需的技能和知识。你可以专注于本版中的新内容，并快速了解近年来网络应用程序安全领域的变化。

第二版的一个重要新特定是在整本书中包含了几乎所有涵盖的漏洞的真实案例。无论你看到哪里有”试试！“链接，你都可以在线交互地使用正在讨论的示例，以确认你可以找到并利用其中包含的漏洞。有数百个这样的实验环境，你可以按照自己的进度在阅读本书时完成。在线实验室可以通过订阅获得，只需支付少量费用即可支付托管和维护相关基础设施的成本。

如果你想专注于第二版的新内容，以下是材料添加或重写的关键领域摘要：

**第1章”网络应用程序（不）安全性“** 已部分更新，以反映网络应用程序的新用途、某些广泛的技术趋势以及典型组织的安全边界持续变化的方式。

**第2章”核心防御机制“** 进行了微小的更改。添加了一些绕过输入验证防御的通用技术的示例。

**第3章”网络应用程序技术“** 已扩展，包括一些新部分，描述了新的或在第一版中描述更简短的技术。新增主体包括REST、Ruby on Rails、SQL、XML、Web服务、CSS、VBScript、文档对象模型、Ajax、JSON、同源策略和HTML5。

**第4章”映射应用程序“** 进行了各种小更新，以反映映射内容和功能的技术发展。

**第5章”绕过客户端控制“** 进行了更广泛的跟新。特别是，关于浏览器扩展技术的部分已进行了大量重写，包括有关字节码反编译和调试的通用方法、如何处理常见格式的序列化数据以及如何处理常见障碍的更详细指南，包括非代理感知客户端和SSL问题。本章还涵盖了Silverlight技术。

**第6章”攻击身份认证“** 保持最新，只有微小的更新。

**第7章”攻击会话管理“** 已更新，涵盖了用于自动测试令牌随机性质量的新工具。它还包含有关攻击加密令牌的新材料，包括在不知道加密算法或使用的加密密钥的情况下篡改令牌的实用技术。

**第8章”攻击访问控制“** 现在涵盖了由于直接访问服务器端方法和基于HTTP方法的规则用于控制访问的平台配置错误而产生的访问控制漏洞。它还描述了一些新工具和技术，可用于部分自动化通常繁琐的测试访问控制任务。

第9和10章的材料进行了重新组织，以创建更易管理的章节和更合理的主体安排。**第9章”攻击数据存储“ **侧重于SQL注入和针对其他数据存储技术的类似攻击。随着SQL注入漏洞的广泛理解和解决，该材料现在更侧重于发现SQL注入的实际情况。整个内容也有小幅跟新，以反映当前技术和攻击方法。新增了一个实用自动化工具利用SQL注入漏洞的章节。LDAP注入的材料以进行了大量重写，包括对特定技术（Microsoft Active Directory和OpenLADP）的更详细介绍，以及利用常见漏洞的新技术。本章现在还涵盖了对NoSQL的攻击。

**第10章”攻击后端组件“** 涵盖了之前包含在第9章中的其他类型的服务器端注入漏洞。新章节涵盖了XML外部实体注入和后端HTTP请求注入，包括HTTP参数注入/污染/和URL重写方案中的注入。

**第11章攻击应用程序逻辑** 包含了更多关于输入验证函数中常见逻辑缺陷的实际案例。随着使用加密保护静态应用程序数据的增加，我们还包括了一个如何识别和利用加密预言机来解密加密数据的示例。

之前在第12章中介绍的对其他应用陈旭用户的攻击主题已拆分为两个章节，因为该材料变得过于庞大。**第12章”攻击用户：跨站脚本“** 仅关注XSS。该材料在各个方面都进行了广泛更新。关于绕过防御性过滤器以引入脚本代码的部分已被完全重写，以涵盖新技术和技术手段，包括在当前浏览器上执行脚本代码的各种鲜为人知的方法。还更详细地介绍了混淆脚本代码以绕过常见输入过滤器的方法。本章包含几个真实世界XSS攻击的新示例。在具有挑战性的条件下交付工作XSS利用的新部分涵盖了跨应用程序页面升级攻击、通过cookie和Referer标头利用XSS以及在非标准请求和响应内容（如XML）中利用XSS。详细检查了浏览器内置的XSS过滤器以及如何绕过这些过滤器来传递漏洞。新部分讨论了在Web邮件应用程序和上传文件中利用XSS的特定技术。最后，对可用于XSS攻击的防御措施进行了各种更新。

新的**第13章”攻击用户:其他技术“** 整合了这个领域的其余部分。跨站点请求伪造主题已更新，包括针对登录功能的CSRF攻击、反CSRF防御中的常见缺陷、UI修复攻击和防帧破坏防御中的常见缺陷。跨域数据捕获的新部分包括注入包含非脚本HTML和CSS的文本以及使用JavaSCript和E4X进行跨域数据捕获的各种技术。新的一节更详细地检查了同源策略，包括其在不同浏览器扩展技术中的实现、HTML5带来的变化以及通过代理服务应用程序跨域的方法。有关客户端cookie注入、SQL注入和HTTP参数污染的新部分。客户端隐私攻击部分已扩展到包括浏览器扩展技术和HTML5提供的存储机制。最后，添加了一个新部分，总结了针对不依赖于任何特定应用程序漏洞的Web用户的一般攻击。这些攻击可以由任何恶意或被破坏的网站或网络上适当定位的攻击者发起。

**第14章”自动化定制攻击“** 已扩展到涵盖常见的自动化阻碍以及如何绕过它们。许多应用程序采用防御性会话处理机制，这些机制会终止会话、使用临时反CSRF令牌或使用多阶段过程来更新应用程序状态。本章描述了一些用于处理这些机制的新工具，可以让你继续使用自动化测试技术。新部分研究了验证码控件以及一些常见的漏洞，这些漏洞通常可以被利用来绕过它们。

**第15章”利用信息泄露“** 包含了有关错误消息中的XSS和利用解密预言机的新部分。

**第16章”攻击原生编译应用程序“** 没有更新

**第17章”攻击应用程序架构“** 新增了一个关于云架构中出现漏洞的部分，并更新了利用架构弱点的一些示例。

**第18章攻击应用程序服务器** 包含了几个关于应用程序服务器和平台的有趣漏洞的新示例，包括Jetty、JMX管理控制台、ASP.NET、APPLE iDisk服务器、Ruby WEBrick Web服务器和Jaba Web服务器。它还新增了一个关于绕过Web应用程序防火墙的实用方法部分。

**第19章”在源代码中查找漏洞“** 没有更新。

**第20章”网络应用程序黑客工具箱“** 更新了基于代理的工具套件的最新功能详细信息。它包含了有关如何代理非代理感知客户端流量以及如何消除拦截代理的使用导致浏览器和其它客户端中的SSL错误的新部分。本章详细描述了使用基于代理的工具套件进行测试时通常采用的工作流程。它还新增了讨论当前网络漏洞扫描程序以及在不同情况下使用它们的最佳方法。

**第21章 网络应用程序黑客方法论** 已更新，以反映整本书中描述的新方法步骤。

## 你需要的工具

本书强烈倾向于你可以用来攻击网络应用程序的实践技术。阅读本书后，你将了解每个单独任务的细节，它在技术上的涉及以及它如何帮助你检测和利用安全漏洞。本书绝对不是关于下载工具、将其指向目标程序并相信工具的输出告诉你应用程序安全状态的。

也就是说，在执行我们描述的任务和技术时，你会发现几个工具有用，有时甚至是不可或缺的。所有这些都可以在互联网上获得。我们建议你在阅读时下载并尝试每个工具。

## 网站资源

本书配套网站位于[http://mdsec.net/wahh](http://mdsec.net/wahh) ,你也可以从[www/wiley.com/go/webhacker2e](www/wiley.com/go/webhacker2e) 进入网站。该网站包含以下几种资源，将帮助你掌握我们描述的技术并将其用于攻击实际应用程序。

- 部分书中脚本的源代码。

- 书中讨论的所有工具和其他资源的最新链接列表。

- 攻击典型应用程序所涉及任务的便捷清单。

- 每章末尾问题的答案。

- 本书示例中使用的数百个互动式漏洞体验，可通过订阅方式获得，帮助你开发和磨练你的技能。

## 开始行动

网络应用程序安全仍然是一个有趣且蓬勃发展的主题。我们喜欢写这本书，就像我们每天喜欢黑入网络应用程序一样。我们也希望你也能享受学习我们描述的不同技术以及如何防范它们的过程。

在继续之前，我应该提出一项重要警告。在大多数国家，未经所有者许可攻击计算机系统是违法的。我们描述的大多数技术如果没有得到同意，都是非法的。

作者是专业的渗透测试人员，代表客户定期攻击网络应用程序以帮助他们提高安全性。近年来，许多安全专业人员与其他人在未经许可的情况下试验或主动攻击计算机系统而犯罪并终结了他们的职业生涯。我们敦促你将本书中的信息用于合法目的。




